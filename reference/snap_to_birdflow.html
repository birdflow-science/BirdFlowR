<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function aligns bird movement data that has both location and date
information with a BirdFlow model's cells and timesteps.
Optionally,it will aggregate multiple points from a track within the same
week into a single point and date prior to determining the location ID."><title>Assign cells and timesteps to coordinates and dates — snap_to_birdflow • BirdFlowR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Assign cells and timesteps to coordinates and dates — snap_to_birdflow"><meta property="og:description" content="This function aligns bird movement data that has both location and date
information with a BirdFlow model's cells and timesteps.
Optionally,it will aggregate multiple points from a track within the same
week into a single point and date prior to determining the location ID."><meta property="og:image" content="https://birdflow-science.github.io/BirdFlowR/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BirdFlowR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.1.0.9052</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/BirdFlowR.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/BirdFlowOverview.html">BirdFlow Model Overview, Uses, and Limitations</a>
    <a class="dropdown-item" href="../articles/Installation.html">Detailed installation instructions</a>
    <a class="dropdown-item" href="../articles/Preprocess.html">Preprocess and sparsify</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/birdflow-science/BirdFlowR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Assign cells and timesteps to coordinates and dates</h1>
      <small class="dont-index">Source: <a href="https://github.com/birdflow-science/BirdFlowR/blob/HEAD/R/snap_to_birdflow.R" class="external-link"><code>R/snap_to_birdflow.R</code></a></small>
      <div class="d-none name"><code>snap_to_birdflow.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function aligns bird movement data that has both location and date
information with a BirdFlow model's cells and timesteps.
Optionally,it will aggregate multiple points from a track within the same
week into a single point and date prior to determining the location ID.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">snap_to_birdflow</span><span class="op">(</span></span>
<span>  <span class="va">d</span>,</span>
<span>  <span class="va">bf</span>,</span>
<span>  x_col <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  y_col <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  date_col <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>  id_cols <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"EPSG:4326"</span>,</span>
<span>  aggregate <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>d</dt>
<dd><p>A data frame with bird movement data it must have the columns
specified by <code>x_col</code>, <code>y_col</code>, <code>date_col</code>, and <code>id_cols</code>.  The default
values for the first three are  <code>"lon"</code>, <code>"lat"</code>, and<code>"date"</code>.</p></dd>


<dt>bf</dt>
<dd><p>A BirdFlow model</p></dd>


<dt>x_col</dt>
<dd><p>The name of the column that holds x or longitude coordinates.
Default is <code>"lon"</code>.</p></dd>


<dt>y_col</dt>
<dd><p>The name of the y or latitude column, default is <code>"lat"</code>.</p></dd>


<dt>date_col</dt>
<dd><p>Name of the date column, defaults to <code>"date"</code></p></dd>


<dt>id_cols</dt>
<dd><p>The name of identification columns. One or more columns that
collectively define a unique track. If <code>aggregate</code> is not <code>NULL</code> these along
with <code>timestep</code> (calculated from the <code>date_col</code>) are used to define the
groups.  If aggregate is <code>NULL</code> these columns are not used but are retained
in the output.</p></dd>


<dt>crs</dt>
<dd><p>The coordinate reference system used by <code>x_col</code> and
<code>y_col</code>. The default <code>"EPSG:4326"</code> corresponds to
<a href="https://epsg.io/4326" class="external-link">WGS 1984</a></p></dd>


<dt>aggregate</dt>
<dd><p>Leave the default <code>NULL</code> for no aggregation - each row in
<code>d</code> is processed separately and represented in the returned object.
If <code>aggregate</code> is set to one of the values below then the locations (rows)
in <code>d</code> that fall in the same week and track (see <code>id_cols</code>) will be
aggregated together such that there is only one location per week for each
track.</p>
<p>The possible values for <code>aggregate</code> are:</p><ul><li><p><code>mean</code> The mean of the "x", "y", and "date" columns are used for the week.</p></li>
<li><p><code>median</code> The median of the "x", "y", and "date" columns are  used for the
week.</p></li>
<li><p><code>midweek</code> The observation that is closest to the middle of the week is
used to represent the week. With ties the observation that occurs first
is used.</p></li>
</ul><p>Pending ideas, not yet implemented:</p><ul><li><p><code>gmedian</code> <a href="https://cran.r-project.org/web/packages/Gmedian/index.html" class="external-link">geometric median</a></p></li>
<li><p><code>central</code> The point closest to the centroid of all the points is used to
represent the week.</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data frame with columns</p>
<dl><dt><code>&lt;id_cols&gt;</code></dt>
<dd><p>The columns identified with <code>id_cols</code> will be retained
and be leftmost.</p></dd>

<dt>date</dt>
<dd><p>This column will have information from <code>date_col</code> but not retain
its name or original formatting. If aggregate is NULL the input dates
will be retained, if not the date will vary with the aggregation method but
will represent the dates that went into the summary and not the mid-week
date associated with <code>timestep</code>.
For example with <code>aggregate = "mean"</code> the date will be the average date of
the points in the week.</p></dd>

<dt>timestep</dt>
<dd><p>The model timestep associated with <code>date</code>.</p></dd>

<dt>x, y</dt>
<dd><p>The x and y coordinates of the point. These will always be in
<code>crs(bf)</code> and will represent the original or aggregated location and
not the cell center.</p></dd>

<dt>i</dt>
<dd><p>The location index of the cell associated with the <code>x</code> and <code>y</code> in
<code>bf</code>.  See <code><a href="index_conversions.html">i_to_xy()</a></code>.</p></dd>

<dt>n</dt>
<dd><p>The number of rows in <code>d</code> that contributed to each output row.
If aggregate is NULL every value will be 1.</p></dd>

<dt>error</dt>
<dd><p>TRUE if there was an error.</p></dd>

<dt>message</dt>
<dd><p>NA or the error message. The possible messages are:</p><ul><li><p>"err_date" - The date could not be parsed with <code><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">lubridate::as_date()</a></code></p></li>
<li><p>"err_truncated" - <code>bf</code> is <a href="truncate_birdflow">truncated</a> and the date
falls outside of portion of the year the model covers.</p></li>
<li><p><code>"err_coords"</code> - The coordinates could not be transformed into <code>crs(bf)</code>
and thus likely are corrupt in some way.</p></li>
<li><p><code>"err_not_active"</code> - the location does not fall within an active cell
as defined by the static mask.</p></li>
<li><p><code>"err_dynamic"</code> - the location does not fall within the dynamic mask on
the associated date.</p></li>
<li><p><code>"err_sparse"</code> - the location falls within the dynamic mask but that
location and date combination has been eliminated by
<a href="sparsify">sparsification</a>.</p></li>
</ul><p>The function will always return the error message that appears first on
this list, even though in some cases multiple errors can be triggered.</p>
<p>With aggregation the first three errors prevent a row from being used and
it will be dropped prior to aggregation with a warning.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If <code>aggregate</code> is NULL than than each row in the output will correspond with
the same row in the input.  With aggregation rows can be lost in two ways
(1) if the coordinates or timestep can't be resolved (first three errors
on list) then the row is dropped prior to aggregation.
(2) via aggregation all the rows within a week for a track will be collapsed
to one. These aggregated locations can still trigger the other three
errors on the list.</p>
<p>A location id will only be assigned if the location is a valid location for
the model on the associated date.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">bf</span> <span class="op">&lt;-</span> <span class="fu">BirdFlowModels</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/BirdFlowModels/man/BirdFlowModels.html" class="external-link">rewbla</a></span> <span class="op">|&gt;</span> <span class="fu"><a href="add_dynamic_mask.html">add_dynamic_mask</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu">BirdFlowModels</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/BirdFlowModels/man/rewbla_banding_data.html" class="external-link">rewbla_observations</a></span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">snap_to_birdflow</span><span class="op">(</span><span class="va">obs</span>, <span class="va">bf</span>, id_cols <span class="op">=</span> <span class="st">"bird_id"</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ethan Plunkett, Daniel Sheldon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

