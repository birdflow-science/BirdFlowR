<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Set low values to zero in a BirdFlow model marginals to reduce object size."><title>sparsify BirdFlow models — sparsify • BirdFlowR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="sparsify BirdFlow models — sparsify"><meta property="og:description" content="Set low values to zero in a BirdFlow model marginals to reduce object size."><meta property="og:image" content="https://birdflow-science.github.io/BirdFlowR/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BirdFlowR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.1.0.9044</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/BirdFlowR.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/BirdFlowOverview.html">BirdFlow Model Overview, Uses, and Limitations</a>
    <a class="dropdown-item" href="../articles/Installation.html">Detailed installation instructions</a>
    <a class="dropdown-item" href="../articles/Preprocess.html">Preprocess and sparsify</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/birdflow-science/BirdFlowR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>sparsify BirdFlow models</h1>
      <small class="dont-index">Source: <a href="https://github.com/birdflow-science/BirdFlowR/blob/HEAD/R/sparsify.R" class="external-link"><code>R/sparsify.R</code></a></small>
      <div class="d-none name"><code>sparsify.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Set low values to zero in a BirdFlow model marginals to reduce object size.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sparsify</span><span class="op">(</span><span class="va">x</span>, <span class="va">method</span>, p <span class="op">=</span> <span class="fl">0.99</span>, fix <span class="op">=</span> <span class="cn">TRUE</span>, p_protected <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>A BirdFlow model.</p></dd>


<dt>method</dt>
<dd><p>One of ``"conditional"<code>, </code>"marginal"`, or `"model"`.
See "Methods" section below for details.</p></dd>


<dt>p</dt>
<dd><p>Required to control the proportion of the
probability density retained in the sparsification process. See "Methods"
below.</p></dd>


<dt>fix</dt>
<dd><p>If TRUE call <code><a href="fix_dead_ends.html">fix_dead_ends()</a></code> to eliminate dead ends
in the sparse model, but only honored if the method produces dead ends.</p></dd>


<dt>p_protected</dt>
<dd><p>Only used with <code>"conditional</code> method.
The proportion of <strong>cells</strong> in each row and column that are protected from
being zeroed out.  Any value of <code>p_protected</code> above 0 protects all the
non-dynamically-masked (NDM) locations from being dropped from the model.
The default value of <code>0.10</code> means that from any NDM location there will
always be transitions retained to at least 10% of the next timestep's
NDM locations.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A BirdFlow object with some values in the marginals set to zero. The
metadata will also be updated with sparsification statistics. The
marginals will be standardized so that they sum to 1.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The BirdFlow model fitting algorithm cannot predict a complete zero, however
many of the marginal values are very close to zero and have little
impact on the model predictions. <code>sparsify()</code> forces small values to
zero with the goal of saving memory, reducing file size, and decreasing run
time. Marginals are stored as sparse matrices
(<a href="https://rdrr.io/pkg/Matrix/man/Matrix.html" class="external-link">Matrix::Matrix(x , sparse = TRUE)</a> ) so only non-zero
values consume memory.</p>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>
    <p>There are three sparsification methods that are all
based on proportion. They use <code>p</code> to control the
amount of sparsification; where <code>p</code> is the target
proportion of the density to retain after eliminating all values below a
(calculated) threshold.</p>
<p>The thresholds are calculated and applied either to the whole model
(<code>model</code>)  or repeatedly to its components (<code>conditional</code>, <code>marginal</code>).</p>
<dl><dt><code>model</code></dt>
<dd><p>In model sparsification the values from all marginals are
pooled and then a threshold is chosen for that entire model such that zeroing
values below the threshold results in the target proportion, <code>p</code>, of the
model's density remaining.</p></dd>


<dt><code>marginal</code></dt>
<dd><p>A threshold is chosen and applied separately to each
marginal in the model.  Ultimately, <code>p</code> is achieved for the model as a whole
but the threshold below which cells are set to zero varies across marginals.</p></dd>


<dt><code>conditional</code></dt>
<dd><p>This method targets (<code>1 - p</code>) of both the forward and
backward <strong>conditional probabilities</strong> to be zeroed out but also guarantees
that at least <code>p_protected</code> proportion of the <strong>cells</strong> in each row
and column will not be zeroed out.</p>
<p>In this method thresholds are chosen independently for each row and each
column of a marginal prior to any zeroing and then the cells that fall
below either their row or column thresholds are set to zero as long as they
aren't within the  <code>p_protected</code> proportion of cells (highest value cells)
that are protected from zeroing based on either their row or column.
<code>p_protected</code> thus prevents the number of transitions in the sparse model
from any state falling below the given proportion of the
transitions in the full model.  The default value means that for every
location at every timestep at least 10% of the transitions to locations in
the next timestep are retained.</p>
<p>This method does not hit its target <code>p</code> density retained. In theory twice
as much density as <code>p</code> implies could could be cut from the model if the
cells targeted based on row and column do not overlap, or much more than
<code>p</code> could be retained with high values of <code>p_protected</code></p></dd>


</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Full models are huge so we don't distribute them.</span></span></span>
<span class="r-in"><span><span class="co"># Assuming you have an hdf5 file with a full model you could run:</span></span></span>
<span class="r-in"><span><span class="va">bf</span> <span class="op">&lt;-</span> <span class="fu"><a href="import_birdflow.html">import_birdflow</a></span><span class="op">(</span><span class="va">hdf5_path</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sbf</span> <span class="op">&lt;-</span> <span class="fu">sparsify</span><span class="op">(</span><span class="va">bf</span>, method <span class="op">=</span> <span class="st">"marginal+state"</span>, p <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ethan Plunkett, Daniel Sheldon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

