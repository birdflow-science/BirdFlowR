<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Retrieve, crop, and transform Natural Earth data — get_naturalearth • BirdFlowR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Retrieve, crop, and transform Natural Earth data — get_naturalearth"><meta name="description" content="These are convenience wrappers to rnaturalearth functions. They
retrieve, crop, format, and project
Natural Earth
data to facilitate plotting with
BirdFlow and other spatial objects. The output is the desired data in the
same coordinate reference system (CRS) and extent as x."><meta property="og:description" content="These are convenience wrappers to rnaturalearth functions. They
retrieve, crop, format, and project
Natural Earth
data to facilitate plotting with
BirdFlow and other spatial objects. The output is the desired data in the
same coordinate reference system (CRS) and extent as x."><meta property="og:image" content="https://birdflow-science.github.io/BirdFlowR/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BirdFlowR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.1.0.9076</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/BirdFlowR.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/BirdFlowOverview.html">BirdFlow Model Overview, Uses, and Limitations</a></li>
    <li><a class="dropdown-item" href="../articles/Installation.html">Detailed installation instructions</a></li>
    <li><a class="dropdown-item" href="../articles/Polygons.html">Calculate movement among polygons</a></li>
    <li><a class="dropdown-item" href="../articles/Preprocess.html">Preprocess and sparsify</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/birdflow-science/BirdFlowR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Retrieve, crop, and transform Natural Earth data</h1>
      <small class="dont-index">Source: <a href="https://github.com/birdflow-science/BirdFlowR/blob/main/R/get_naturalearth.R" class="external-link"><code>R/get_naturalearth.R</code></a></small>
      <div class="d-none name"><code>get_naturalearth.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These are convenience wrappers to <span class="pkg">rnaturalearth</span> functions. They
retrieve, crop, format, and project
<a href="https://www.naturalearthdata.com/" class="external-link">Natural Earth</a>
data to facilitate plotting with
BirdFlow and other spatial objects. The output is the desired data in the
same coordinate reference system (CRS) and extent as <code>x</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_naturalearth</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">type</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"medium"</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  keep_attributes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">country</span>,</span>
<span>  keep_buffer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  force_old_method <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_states</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">country</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"medium"</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  keep_attributes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  keep_buffer <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_coastline</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"medium"</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  keep_attributes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  keep_buffer <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_countries</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  scale <span class="op">=</span> <span class="st">"medium"</span>,</span>
<span>  buffer <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  keep_attributes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  keep_buffer <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A BirdFlow, <a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">terra::SpatRaster</a>,
<a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">sf</a>, or any other object
on which you can call <code><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">terra::ext()</a></code> and <code><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">terra::crs()</a></code>.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>The type of data to retrieve. One of "coastline", "country", or
"states" for data included in <span class="pkg">rnaturalearth</span>; or any value accepted by
<a href="https://docs.ropensci.org/rnaturalearth/reference/ne_download.html" class="external-link">ne_download()</a>.</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>The scale of data to return. Ignored if type is "states",
otherwise passed to one of <a href="https://docs.ropensci.org/rnaturalearth/reference/ne_download.html" class="external-link">ne_download()</a>.
<a href="https://docs.ropensci.org/rnaturalearth/reference/ne_coastline.html" class="external-link">ne_coastline()</a>, or
<a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries()</a>.
Valid values are 110, 50, 10, 'small', 'medium', and 'large'.</p></dd>


<dt id="arg-buffer">buffer<a class="anchor" aria-label="anchor" href="#arg-buffer"></a></dt>
<dd><p>A buffer in degrees (latitude and longitude) to add to the
extent of <code>x</code> prior to cropping the Natural Earth data in WGS84. This is
needed so that after transformation to the CRS of <code>x</code> the data cover all
of the extent of <code>x</code>.</p></dd>


<dt id="arg-keep-attributes">keep_attributes<a class="anchor" aria-label="anchor" href="#arg-keep-attributes"></a></dt>
<dd><p>If <code>FALSE</code>, the default, attribute columns are dropped
to facilitate clean plotting.</p></dd>


<dt id="arg-country">country<a class="anchor" aria-label="anchor" href="#arg-country"></a></dt>
<dd><p>If retrieving states with <code>get_states()</code> or
<code>get_naturalearth(type = "states")</code> this is used to select a country. If
omitted, states from all countries are returned.</p></dd>


<dt id="arg-keep-buffer">keep_buffer<a class="anchor" aria-label="anchor" href="#arg-keep-buffer"></a></dt>
<dd><p>If <code>FALSE</code>, the default, after transforming the Natural
Earth data it will cropped to the precise extent of <code>x</code>. Set to  <code>TRUE</code>
to keep the buffer - useful when overlaying Natural Earth data
on an existing base R plot.</p></dd>


<dt id="arg-force-old-method">force_old_method<a class="anchor" aria-label="anchor" href="#arg-force-old-method"></a></dt>
<dd><p>This is for internal testing. The default should be
best for all other uses.  If <code>TRUE</code> use the back transformed bounding box
method even if the projection is covered by the "new" cut at seam method.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments to be passed to
<a href="https://docs.ropensci.org/rnaturalearth/reference/ne_download.html" class="external-link">ne_download()</a>. Possibly you will
want to use <code>category = "physical"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">sf</a> object with Natural Earth data in the same
CRS as <code>x</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>get_naturalearth()</code> does all the work and is called by the other functions.
There are two distinct calculation methods.</p><ol><li><p>For Mollweide, Lambert Azimuthal Equal Area,  Albers Equal Area, and
Lambert Conformal Conic projections cut at the seam:</p><ul><li><p>Find the longitude of projection center ("lon_0" in proj4 string) and
from it determine longitude of the seam.</p></li>
<li><p>Clip a narrow (1 m) strip out of the Natural Earth data before
transforming (in WGS84) at the seam.</p></li>
<li><p>Transform to the CRS of <code>x</code>. This is now an artifact free object
containing the global data set minus a narrow strip at the seam.</p></li>
<li><p>Crop in destination to the extent of <code>x</code>, or if <code>keep_buffer = TRUE</code>,
the extent plus the approximate equivalent of <code>buffer</code>.</p></li>
</ul><p>This should work well for any extent (including global) in any CRS that is
based on the covered projections.</p></li>
<li><p>For all other projections back transform the bounding box and clip:</p><ul><li><p>Convert the corners of the bounds of <code>x</code> object to WGS84.</p></li>
<li><p>adds a buffer (<code>buffer</code>) to the converted corners this is important to
guarantee that we still cover the extent after we transform.</p></li>
<li><p>Check to see if the bounds wrap the seam (180 deg meridian) and break
the bounding box into two if it does.</p></li>
<li><p>Crop to the bounding box or boxes.</p></li>
<li><p>Project each cropped section to <code>x</code>'s CRS.</p></li>
<li><p>Combine the pieces into one object.</p></li>
<li><p>If <code>keep_buffer = FALSE</code> crop to the exact extent of <code>x</code>.</p></li>
</ul><p>These steps will usually prevent artifacts caused when polygons or lines
are shifted across the bounds of the CRS. However, it does not work for
all extents in all projections and in particular is unlikely to work with
polar projections and with extents that cover the entire globe.</p>
<p>In some cases where this fails setting the buffer to zero may be an easy
solution.</p>
<p>There are many more projections where method 1 or a variant on it
would work. We may eventually cover more of those projections with the
first method.</p>
<p>If you encounter a use case that doesn't work you may
<a href="https://github.com/birdflow-science/BirdFlowR/issues" class="external-link">submit an issue</a>;
please include the output from <code>crs(x)</code> and <code>ext(x)</code>.</p></li>
</ol><p><code>get_states()</code> requires <span class="pkg">rnaturalearthhires</span>. Install with:<br><code> install.packages("devtools") # if you don't have it already
 devtools::install_github("ropensci/rnaturalearthhires") </code></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span> <span class="va">bf</span> <span class="op">&lt;-</span> <span class="fu">BirdFlowModels</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/BirdFlowModels/man/BirdFlowModels.html" class="external-link">amewoo</a></span></span></span>
<span class="r-in"><span> <span class="va">coast</span> <span class="op">&lt;-</span> <span class="fu">get_coastline</span><span class="op">(</span><span class="va">bf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">bf</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coast</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>   <span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ethan Plunkett, National Science Foundation.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

