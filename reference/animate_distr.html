<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Animate distributions as produced by get_distr(),
as_distr(), or predict().  The distributions will be displayed
in the column order in distr and column labels will be used as
plot subtitle."><title>Animate distributions — animate_distr • BirdFlowR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Animate distributions — animate_distr"><meta property="og:description" content="Animate distributions as produced by get_distr(),
as_distr(), or predict().  The distributions will be displayed
in the column order in distr and column labels will be used as
plot subtitle."><meta property="og:image" content="https://birdflow-science.github.io/BirdFlowR/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BirdFlowR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.1.0.9051</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/BirdFlowR.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/BirdFlowOverview.html">BirdFlow Model Overview, Uses, and Limitations</a>
    <a class="dropdown-item" href="../articles/Installation.html">Detailed installation instructions</a>
    <a class="dropdown-item" href="../articles/Preprocess.html">Preprocess and sparsify</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/birdflow-science/BirdFlowR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Animate distributions</h1>
      <small class="dont-index">Source: <a href="https://github.com/birdflow-science/BirdFlowR/blob/HEAD/R/animate_distr.R" class="external-link"><code>R/animate_distr.R</code></a></small>
      <div class="d-none name"><code>animate_distr.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Animate distributions as produced by <code><a href="get_distr.html">get_distr()</a></code>,
<code><a href="as_distr.html">as_distr()</a></code>, or <code><a href="predict.BirdFlow.html">predict()</a></code>.  The distributions will be displayed
in the column order in <code>distr</code> and column labels will be used as
plot subtitle.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">animate_distr</span><span class="op">(</span><span class="va">distr</span>, <span class="va">bf</span>, title <span class="op">=</span> <span class="fu"><a href="species_info.html">species</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>distr</dt>
<dd><p>A set of distributions it should be a matrix with <code>n_active(bf)</code>
rows and a column for each distribution. The animation will proceed in the
in column order and column names will be used a subtitles in the plot.</p></dd>


<dt>bf</dt>
<dd><p>The BirdFlow object that <code>distr</code> is associated with.</p></dd>


<dt>title</dt>
<dd><p>The title to use for the animation. The default is
the common name of the species.</p></dd>


<dt>...</dt>
<dd><p>Arguments passed on to <code><a href="plot_distr.html">plot_distr</a></code></p><dl><dt><code>subset</code></dt>
<dd><p>Defines an optional subset of <code>distr</code> that should be plotted.
Use either column numbers, column names, or a logical vector.</p></dd>

    <dt><code>show_mask</code></dt>
<dd><p>If <code>TRUE</code> (the default) the static mask that indicates which
cells are active in the model at any timestep will be shown.</p></dd>

    <dt><code>show_dynamic_mask</code></dt>
<dd><p>Defaults to <code>FALSE</code>. Set to <code>TRUE</code> to visualize the
dynamic mask. This is achieved by overwriting cells that are dynamically
masked with NA. For <code>show_dynamic_mask = TRUE</code> to work the column names in
<code>distr</code> should all be in <code>colnames(get_distr(bf))</code>.  This is
true for distributions returned by <a href="predict.BirdFlowR"><code><a href="predict.BirdFlow.html">predict()</a></code></a>
and <code><a href="get_distr.html">get_distr()</a></code>.</p></dd>

    <dt><code>limits</code></dt>
<dd><p>The range of density values to map <code>gradient_colors</code> to. The
default is the range of the values in <code>distr</code> after applying <code>subset</code>. If
you want to standardize the range across multiple models of a single
species you might want to set to <code>c(0, max)</code> where <code>max</code> is the maximum
observed value across all models. Alternatively if the range is highly
variable among the columns in <code>distr</code> as when density spreads out from a
single point in the results of <a href="predict.BirdFlowR"><code>predict(bf)</code></a> you may
want to set this smaller than the full range in which case the values will
be truncated to the limits (see examples).</p></dd>

    <dt><code>dynamic_scale</code></dt>
<dd><p>Set to <code>TRUE</code> to have the range of the data in each
distribution mapped to the full color gradient. This allows visualizing the
full range of values within each timestep optimally at the cost of
consistency in the color scale among the facets - or animation frames
if using <code>animate_distr()</code>.</p></dd>

    <dt><code>coast_linewidth</code></dt>
<dd><p>The line width to use when plotting the coast. Default
is <code>0.25</code>.  If <code>NULL</code> the coast will not be plotted.</p></dd>

    <dt><code>coast_color</code></dt>
<dd><p>The color to use for plotting the coastline. If <code>NULL</code> the
coast will not be plotted.</p></dd>

    <dt><code>gradient_colors</code></dt>
<dd><p>A color gradient that will be used to plot the density
values. Leave or set to <code>NULL</code> for the default of
<code>ebirdst::abundance_palette(10, season = "weekly")</code>.</p></dd>

    <dt><code>active_cell_color</code></dt>
<dd><p>The background color for active cells in the
landscape. Only used if <code>show_mask</code> is <code>TRUE</code>. These cells will only be
visible if there are <code>NA</code> values in <code>distr</code> or if <code>show_dynamic_mask</code>
is <code>TRUE</code>.</p></dd>

    <dt><code>inactive_cell_color</code></dt>
<dd><p>The color to use for inactive cells in the
landscape. These are cells that are always masked. Only relevant when
<code>show_mask = TRUE</code>.</p></dd>

    <dt><code>value_label</code></dt>
<dd><p>The label used for the values in the distribution.
Defaults to "Density"</p></dd>

  
</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A gganimate object that can be displayed with <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> or
or <code><a href="https://gganimate.com/reference/animate.html" class="external-link">gganimate::animate()</a></code>.  See example for how to export to a file.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Animate distributions from BirdFlow object - derived from</span></span></span>
<span class="r-in"><span><span class="co"># eBird Status and Trends:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bf</span> <span class="op">&lt;-</span> <span class="fu">BirdFlowModels</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/BirdFlowModels/man/BirdFlowModels.html" class="external-link">amewoo</a></span></span></span>
<span class="r-in"><span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="lookup_timestep_sequence.html">lookup_timestep_sequence</a></span><span class="op">(</span><span class="va">bf</span>, season <span class="op">=</span> <span class="st">"prebreeding"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">distr</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_distr.html">get_distr</a></span><span class="op">(</span><span class="va">bf</span>, <span class="va">ts</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">anim</span> <span class="op">&lt;-</span> <span class="fu">animate_distr</span><span class="op">(</span><span class="va">distr</span>, <span class="va">bf</span>,  show_dynamic_mask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Display it</span></span></span>
<span class="r-in"><span><span class="va">anim</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="co">### Project a distribution</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Make starting distribution</span></span></span>
<span class="r-in"><span><span class="co"># Since we define the point in WGS84 (not crs(bf)) we also have to provide</span></span></span>
<span class="r-in"><span><span class="co"># the crs.</span></span></span>
<span class="r-in"><span><span class="va">point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, y <span class="op">=</span> <span class="fl">35</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="as_distr.html">as_distr</a></span><span class="op">(</span><span class="va">point</span>, <span class="va">bf</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Project - density will spread over type resulting in a vastly different</span></span></span>
<span class="r-in"><span><span class="co"># range of values</span></span></span>
<span class="r-in"><span><span class="va">density_spread</span> <span class="op">&lt;-</span> <span class="fu"><a href="predict.BirdFlow.html">predict</a></span><span class="op">(</span><span class="va">bf</span>, <span class="va">d1</span>, season <span class="op">=</span> <span class="st">"prebreeding"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Have the color gradient rescaled to the range of data in each</span></span></span>
<span class="r-in"><span><span class="co"># individual frame  - density scaling is dynamic.</span></span></span>
<span class="r-in"><span><span class="va">spread_anim</span> <span class="op">&lt;-</span> <span class="fu">animate_distr</span><span class="op">(</span><span class="va">density_spread</span>, <span class="va">bf</span>,   dynamic_scale<span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Or put in values to use for the limits of the color scale - values outside</span></span></span>
<span class="r-in"><span><span class="co"># of the limits will be truncated</span></span></span>
<span class="r-in"><span><span class="va">spread_anim</span> <span class="op">&lt;-</span> <span class="fu">animate_distr</span><span class="op">(</span><span class="va">density_spread</span>, <span class="va">bf</span>,  limit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># example render fo file</span></span></span>
<span class="r-in"><span>  <span class="va">gif</span> <span class="op">&lt;-</span> <span class="fu">gganimate</span><span class="fu">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">spread_anim</span>,</span></span>
<span class="r-in"><span>                            device <span class="op">=</span> <span class="st">"ragg_png"</span>, <span class="co"># fast and pretty</span></span></span>
<span class="r-in"><span>                            width <span class="op">=</span> <span class="fl">7</span>, height <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                            res <span class="op">=</span> <span class="fl">150</span>, units <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Display</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gif</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># mv</span></span></span>
<span class="r-in"><span>  <span class="va">gif_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"animation"</span>, fileext <span class="op">=</span> <span class="st">".gif"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu">gganimate</span><span class="fu">::</span><span class="fu"><a href="https://gganimate.com/reference/save_animation.html" class="external-link">save_animation</a></span><span class="op">(</span><span class="va">gif</span>, <span class="va">gif_file</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">gif_file</span><span class="op">)</span> <span class="co"># cleanup</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ethan Plunkett, Daniel Sheldon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

