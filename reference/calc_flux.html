<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="calc_flux() estimates the proportion of the species that passes near
a set of points during each transition in a BirdFlow model."><title>Estimate bird flux — calc_flux • BirdFlowR</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate bird flux — calc_flux"><meta property="og:description" content="calc_flux() estimates the proportion of the species that passes near
a set of points during each transition in a BirdFlow model."><meta property="og:image" content="https://birdflow-science.github.io/BirdFlowR/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BirdFlowR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.1.0.9064</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/BirdFlowR.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/BirdFlowOverview.html">BirdFlow Model Overview, Uses, and Limitations</a>
    <a class="dropdown-item" href="../articles/Installation.html">Detailed installation instructions</a>
    <a class="dropdown-item" href="../articles/Preprocess.html">Preprocess and sparsify</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/birdflow-science/BirdFlowR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimate bird flux</h1>
      <small class="dont-index">Source: <a href="https://github.com/birdflow-science/BirdFlowR/blob/HEAD/R/calc_flux.R" class="external-link"><code>R/calc_flux.R</code></a></small>
      <div class="d-none name"><code>calc_flux.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>calc_flux()</code> estimates the proportion of the species that passes near
a set of points during each transition in a BirdFlow model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_flux</span><span class="op">(</span></span>
<span>  <span class="va">bf</span>,</span>
<span>  points <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  radius <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_directions <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  format <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">5e+05</span>,</span>
<span>  check_radius <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>bf</dt>
<dd><p>A BirdFlow model</p></dd>


<dt>points</dt>
<dd><p>A set of points to calculate movement through. If <code>points</code> is
<code>NULL</code> they will default to the BirdFlow model cells that are either active
or fall between two active cells. Otherwise a data frame with <code>x</code> and  <code>y</code>
columns containing point coordinates in crs(bf).</p></dd>


<dt>radius</dt>
<dd><p>The radius in meters around the points used to assess whether
a movement line passes by (or through) the point. If a point is farther than
<code>radius</code> from a great circle line between two cells centers then it is not
between them.</p></dd>


<dt>n_directions</dt>
<dd><p>The number of directional bins to use for recording
movement direction. Must be either <code>1</code> indicating no direction information
or an even number. This is a placeholder, currently only <code>1</code> is supported.</p></dd>


<dt>format</dt>
<dd><p>The format to return the results in one of:</p><dl><dt><code>"points"</code></dt>
<dd><p>Returns a list with <code>flux</code> a matrix or array of
flux values, and <code>points</code> a data frame of either the input <code>points</code> or the
default cell center derived points.</p></dd>

<dt><code>"dataframe"</code></dt>
<dd><p>Returns a "long" data frame with columns:</p><ul><li><p><code>x</code> and <code>y</code> coordinates of the points.</p></li>
<li><p><code>transition</code> Transition code.</p></li>
<li><p><code>flux</code> The flux at the point. See "Units" below  .</p></li>
<li><p><code>date</code> The date associated with the transition, will be at the midpoint
between timesteps.</p></li>
</ul></dd>

<dt><code>"SpatRaster"</code></dt>
<dd><p>Returns a <code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">terra::SpatRaster</a></code> with layers for each
transition.</p></dd>


</dl></dd>


<dt>batch_size</dt>
<dd><p>controls the number of movement lines that are processed
at a time. A smaller
<code>batch_size</code> will conserve memory at a slight performance cost.  The number
of batches will be less than or equal to <code>n_active(bf)^2 / batch_size</code>.</p></dd>


<dt>check_radius</dt>
<dd><p>If  <code>TRUE</code> an error will be thrown if the radius
is not between the resolution and 1/4 the resolution of <code>bf</code>. Outside of
that range the algorithm is likely to yield distorted results.
<code>0.5 * mean(res(bf))</code> is the default, and recommended radius.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>See <code>format</code> argument.</p>
    </div>
    <div class="section level2">
    <h2 id="units">Units<a class="anchor" aria-label="anchor" href="#units"></a></h2>
    


<p>The total relative abundance passing through the circle centered on the point
is divided by the diameter of the circle in kilometers.  The units of the
returned value is therefore roughly the proportion
(\(P\)) of the
species's population that is expected to pass through each km
of a line oriented perpendicular to the movement at each point:
\(\frac{P}{km \cdot week}\)</p>
<p>Multiplying the result by the total population would yield:
\(\frac{birds}{km \cdot week}\)</p>
    </div>
    <div class="section level2">
    <h2 id="limitations">Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a></h2>
    


<p><code>calc_flux()</code> makes the incorrect simplifying assumption
that birds follow the shortest (great circle) path
between the center of the the source and destination raster cells.  Caution
should be used when interpreting the results especially around
major geographic features such as coasts, large lakes, mountain ranges, and
ecological system boundaries that might result in non-linear migration paths.</p>
<p><code>calc_flux()</code> assumes that a line passes by a point if any part of the line
is within the radius of the point.  This assumption breaks down if the
radius is much larger than the movement lengths as points that are ahead of
the line may still be within a radius of the line.  In the extreme a large
enough radius on a point outside of the entire range will capture all the
movement.  This isn't a problem with
the default points and radius as the points ahead of the line will never be
within the radius.</p>
<p>The default points for <code>calc_flux()</code> are aligned with the cell centers as
are the movement lines. This alignment means that a very small radius will
result in an overestimate of flux. The default value of half the cell size
is sufficient for this not to be a problem, as we are capturing and
standardizing the units based on the entire cell area that that point
represents.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">bf</span> <span class="op">&lt;-</span> <span class="fu">BirdFlowModels</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/BirdFlowModels/man/BirdFlowModels.html" class="external-link">amewoo</a></span></span></span>
<span class="r-in"><span><span class="va">flux</span> <span class="op">&lt;-</span> <span class="fu">calc_flux</span><span class="op">(</span><span class="va">bf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_flux.html">plot_flux</a></span><span class="op">(</span><span class="va">flux</span>, <span class="va">bf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="animate_flux.html">animate_flux</a></span><span class="op">(</span><span class="va">flux</span>, <span class="va">bf</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ethan Plunkett, National Science Foundation.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

