<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="BirdFlowR">
<title>BirdFlowR • BirdFlowR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BirdFlowR">
<meta property="og:description" content="BirdFlowR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BirdFlowR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9034</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/BirdFlowR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Installation.html">Detailed installation instructions</a>
    <a class="dropdown-item" href="../articles/Preprocess.html">Preprocess and sparsify</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>BirdFlowR</h1>
            
      
      
      <div class="d-none name"><code>BirdFlowR.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>Install packages</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">installed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="st">"remotes"</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">installed</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="st">"rnaturalearthdata"</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">installed</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rnaturalearthdata"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"birdflow-science/BirdFlowModels"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"birdflow-science/BirdFlowR"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Load libraries and define local BirdFlow model (<code>bf</code>)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">BirdFlowModels</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://birdflow-science.github.io/BirdFlowR/">BirdFlowR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.18</span></span>
<span></span>
<span><span class="va">bf</span> <span class="op">&lt;-</span> <span class="va">amewoo</span>  <span class="co"># from BirdFlowModels</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="access-basic-information">Access basic information<a class="anchor" aria-label="anchor" href="#access-basic-information"></a>
</h3>
<p><code><a href="../reference/dimensions.html">dim()</a></code>, <code><a href="../reference/dimensions.html">nrow()</a></code>, and <code><a href="../reference/dimensions.html">ncol()</a></code> all
report on raster dimensions associated with the model.
<code>n_active</code> is the total number of cells that the BirdFlow
model can route birds through and is a subset of the cells in the
raster.<br><code><a href="../reference/dimensions.html">n_transitions()</a></code> and <code><a href="../reference/dimensions.html">n_distr()</a></code> report on
temporal dimensions. If the model is circular than they will be equal,
for temporally linear models than <code><a href="../reference/dimensions.html">n_distr()</a></code> will be one
more than <code><a href="../reference/dimensions.html">n_transitions()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Methods for base R functions:</span></span>
<span><span class="fu"><a href="../reference/dimensions.html">dim</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 45 51</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="../reference/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span>, <span class="fu"><a href="../reference/dimensions.html">ncol</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] 45 51</span></span>
<span><span class="va">bf</span> <span class="co"># print(bf) </span></span>
<span><span class="co">#&gt; American Woodcock BirdFlow model</span></span>
<span><span class="co">#&gt;   dimensions   : 45, 51, 52  (nrow, ncol, ntimesteps)</span></span>
<span><span class="co">#&gt;   resolution   : 79995.7798343748, 79995.8424586389  (x, y)</span></span>
<span><span class="co">#&gt;   active cells : 1706</span></span>
<span><span class="co">#&gt;   size         : 18.9 Mb</span></span>
<span></span>
<span><span class="co"># BirdFlowR functions</span></span>
<span><span class="fu"><a href="../reference/dimensions.html">n_active</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1706</span></span>
<span><span class="fu"><a href="../reference/dimensions.html">n_transitions</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 51</span></span>
<span><span class="fu"><a href="../reference/dimensions.html">n_timesteps</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 52</span></span>
<span></span>
<span><span class="co"># Contents</span></span>
<span><span class="fu"><a href="../reference/has.html">has_marginals</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/has.html">has_distr</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/has.html">has_transitions</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="species-information-and-metadata">Species information and metadata<a class="anchor" aria-label="anchor" href="#species-information-and-metadata"></a>
</h3>
<p><code><a href="../reference/species_info.html">species_info()</a></code> and <code><a href="../reference/get_metadata.html">get_metadata()</a></code> take a
BirdFlow object as their first argument. An optional second argument
allows specifying a specific item, if omitted a list is returned with
all the available information.</p>
<p><code>species(bf)</code> is a shortcut for
<code>species_info(bf, "common_name")</code></p>
<p>Use <code>?species_info()</code> to see descriptions of all the
available information. Dates associated with migration and resident
seasons are likely to be useful.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/species_info.html">species</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span>  </span>
<span><span class="co">#&gt; [1] "American Woodcock"</span></span>
<span><span class="fu"><a href="../reference/species_info.html">species</a></span><span class="op">(</span><span class="va">bf</span>, <span class="st">"scientific"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Scolopax minor"</span></span>
<span><span class="fu"><a href="../reference/species_info.html">species_info</a></span><span class="op">(</span><span class="va">bf</span>, <span class="st">"prebreeding_migration_start"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2021-01-18"</span></span>
<span><span class="va">si</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/species_info.html">species_info</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span> <span class="co"># list with all species information</span></span>
<span><span class="va">md</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_metadata.html">get_metadata</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span>  <span class="co"># list with all metadata</span></span>
<span><span class="fu"><a href="../reference/get_metadata.html">get_metadata</a></span><span class="op">(</span><span class="va">bf</span>, <span class="st">"birdflow_model_date"</span><span class="op">)</span> <span class="co"># date model was exported from python</span></span>
<span><span class="co">#&gt; [1] "2023-01-02 10:03:05.256454"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/validate_BirdFlow.html">validate_BirdFlow</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span>  <span class="co"># throws error if there are problems</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spatial-aspects">Spatial aspects<a class="anchor" aria-label="anchor" href="#spatial-aspects"></a>
</h3>
<p>BirdFlow models are based on a raster representation of a time series
of species distributions and contain all the spatial information
necessary to recreate those distributions and to define how the raster
is positioned in space. BirdFlowR uses the terra package to import
raster data and provides BirdFlow methods for functions defined in the
terra package - so that you can use those functions on BirdFlow
objects.</p>
<p><code><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs()</a></code> returns the coordinate reference system - useful
if you need to project other data to match the BirdFlow object.
<code><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">res()</a></code>, <code><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">xres()</a></code>, and <code><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">yres()</a></code>
describe the dimensions of individual cells in the model.
<code><a href="../reference/dimensions.html">ext()</a></code> returns a terra extent object.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Methods for terra functions:</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span> <span class="co"># well known text (long)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">bf</span>, proj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># proj4 string</span></span>
<span><span class="co">#&gt; [1] "+proj=moll +lon_0=-90 +x_0=0 +y_0=0 +ellps=WGS84 +units=m +no_defs"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 79995.78 79995.84</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">xres</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">yres</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span> <span class="op">)</span> <span class="co"># same as res(bf)</span></span>
<span><span class="co">#&gt; [1] 79995.78 79995.84</span></span>
<span><span class="fu"><a href="../reference/dimensions.html">ext</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span></span>
<span><span class="co">#&gt; SpatExtent : -1564958.2138293, 2514826.55772382, 2822153.67510416, 6421966.58574292 (xmin, xmax, ymin, ymax)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/xmin.html" class="external-link">xmin</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/xmin.html" class="external-link">xmax</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/xmin.html" class="external-link">ymin</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/xmin.html" class="external-link">ymax</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span><span class="op">)</span> <span class="co"># same as ext(bf)</span></span>
<span><span class="co">#&gt; [1] -1564958  2514827  2822154  6421967</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieve-and-plot-distributions">Retrieve and plot distributions<a class="anchor" aria-label="anchor" href="#retrieve-and-plot-distributions"></a>
</h3>
<p>A distribution in BirdFlow is stored as a vector of values that
correspond to only the active cells (<code><a href="../reference/dimensions.html">n_active()</a></code>) in the
model. Multiple distributions are stored as matrices with
<code><a href="../reference/dimensions.html">n_active()</a></code> rows (a column for each distribution).</p>
<p>We can retreive distributions in this format with
<code><a href="../reference/get_distr.html">get_distr()</a></code>. Use timestep, character dates, date objects,
or “all” to specify which distributions to retrieve.</p>
<p>Retrieve the first distribution and compare its length to the number
of active cells.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_distr.html">get_distr</a></span><span class="op">(</span><span class="va">bf</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># get first timestep distribution </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>  <span class="co"># 1 distribution so d is a vector</span></span>
<span><span class="co">#&gt; [1] 1706</span></span>
<span><span class="fu"><a href="../reference/dimensions.html">n_active</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span>  <span class="co"># its length is the the number of active cells in the model</span></span>
<span><span class="co">#&gt; [1] 1706</span></span></code></pre></div>
<p>Get 5 distributions, the result is a matrix in which each column is a
distribution with a row for each active cell.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_distr.html">get_distr</a></span><span class="op">(</span><span class="va">bf</span>, <span class="fl">26</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span> </span>
<span><span class="fu"><a href="../reference/dimensions.html">dim</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1706    5</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;       time</span></span>
<span><span class="co">#&gt; i      June 28 July 5 July 12 July 19 July 26</span></span>
<span><span class="co">#&gt;   [1,]       0      0       0       0       0</span></span>
<span><span class="co">#&gt;   [2,]       0      0       0       0       0</span></span>
<span><span class="co">#&gt;   [3,]       0      0       0       0       0</span></span></code></pre></div>
<p>We can also specify distributions with dates, or use “all” to
retrieve all the distributions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_distr.html">get_distr</a></span><span class="op">(</span><span class="va">bf</span>, <span class="st">"2022-12-15"</span><span class="op">)</span> <span class="co"># from character date</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_distr.html">get_distr</a></span><span class="op">(</span><span class="va">bf</span>, <span class="st">"all"</span><span class="op">)</span>  <span class="co"># all distributions</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_distr.html">get_distr</a></span><span class="op">(</span><span class="va">bf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Using a Date object </span></span></code></pre></div>
<p>Use <code><a href="../reference/rasterize.html">rasterize_distr()</a></code> to convert a distribution to a
SpatRaster defined in the terra package. The second argument, the
BirdFlow model, is needed for the spatial information it contains.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_distr.html">get_distr</a></span><span class="op">(</span><span class="va">bf</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">26</span><span class="op">)</span><span class="op">)</span> <span class="co"># winter and summer</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rasterize.html">rasterize_distr</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">bf</span><span class="op">)</span> <span class="co"># convert to SpatRaster </span></span></code></pre></div>
<p>Alternatively convert directly from BirdFlow to SpatRast with
<code><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast()</a></code> the second, optional, argument <code>which</code>
accepts the same inputs a as <code>which</code> in
<code><a href="../reference/get_distr.html">get_distr()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span> <span class="co"># all distributions</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">bf</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">26</span><span class="op">)</span><span class="op">)</span>  <span class="co"># 1st, and 26th timesteps.</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span></code></pre></div>
<p><img src="BirdFlowR_files/figure-html/rast-1.png" width="100%"></p>
<p>BirdFlowR provides some convenience wrappers to functions in
rnaturalearth that load vector data and then crop and reproject it to
make it suitable for plotting with BirdFlow output.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">bf</span>, <span class="fu"><a href="../reference/species_info.html">species_info</a></span><span class="op">(</span><span class="va">bf</span>, <span class="st">"prebreeding_migration_start"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="va">coast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_naturalearth.html">get_coastline</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span>  <span class="co"># lines</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coast</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="BirdFlowR_files/figure-html/unnamed-chunk-2-1.png" width="65%"></p>
</div>
<div class="section level2">
<h2 id="forecasting">Forecasting<a class="anchor" aria-label="anchor" href="#forecasting"></a>
</h2>
<p>In this section we will sample a single starting location from the
winter distribution and project it forward to generate a distribution of
predicted breeding grounds for birds that wintered at the starting
location.</p>
<p>Set forecast parameters.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">1</span>     <span class="co">#  winter </span></span>
<span>    <span class="va">end</span> <span class="op">&lt;-</span>  <span class="fl">26</span>     <span class="co"># summer</span></span></code></pre></div>
<div class="section level3">
<h3 id="sample-starting-distribution">Sample starting distribution<a class="anchor" aria-label="anchor" href="#sample-starting-distribution"></a>
</h3>
<p><code><a href="../reference/sample_distr.html">sample_distr()</a></code> will sample from one or more input
distribution to select a single location per distribution. The result is
one or moe distributions with ones in the selected location(s) and zero
elsewhere.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_distr.html">get_distr</a></span><span class="op">(</span><span class="va">bf</span>, <span class="va">start</span><span class="op">)</span></span>
<span><span class="va">location</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_distr.html">sample_distr</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="fu"><a href="../reference/index_conversions.html">i_to_xy</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span> <span class="op">)</span>, <span class="va">bf</span><span class="op">)</span> <span class="op">)</span>  <span class="co"># starting coordinates</span></span>
<span><span class="co">#&gt;              x       y</span></span>
<span><span class="co">#&gt; [1,] -5040.507 3982093</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="project-forward-from-this-location-to-summer">Project forward from this location to summer<a class="anchor" aria-label="anchor" href="#project-forward-from-this-location-to-summer"></a>
</h3>
<p>Forecast returns the distribution over time as a matrix with one
column per timestep.</p>
<p>The plot shows where birds that winter at a particular location are
likely to be as the year progresses and ultimately where they might
spend their summer. The probability density spreads as the weeks
progress.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forecast.html">forecast</a></span><span class="op">(</span><span class="va">bf</span>, <span class="va">location</span>, <span class="va">start</span>, <span class="va">end</span>, <span class="st">"forward"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rasterize.html">rasterize_distr</a></span><span class="op">(</span><span class="va">f</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span>, <span class="fl">14</span>, <span class="fl">19</span><span class="op">)</span><span class="op">]</span>, <span class="va">bf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span></code></pre></div>
<p><img src="BirdFlowR_files/figure-html/forecast-1.png" width="100%"></p>
<p>Alternatively we can calculate the difference between the projected
distribution for bird’s wintering at that particular location and the
distribution of the species as a whole at the same timestep.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">projected</span> <span class="op">&lt;-</span> <span class="va">f</span><span class="op">[</span> , <span class="fu"><a href="../reference/dimensions.html">ncol</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">]</span>  <span class="co"># last projected distribution</span></span>
<span><span class="va">diff</span> <span class="op">&lt;-</span>  <span class="va">projected</span> <span class="op">-</span> <span class="fu"><a href="../reference/get_distr.html">get_distr</a></span><span class="op">(</span><span class="va">bf</span>, <span class="va">end</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/rasterize.html">rasterize_distr</a></span><span class="op">(</span><span class="va">diff</span>, <span class="va">bf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="BirdFlowR_files/figure-html/probability%20over%20time-1.png" width="65%"></p>
</div>
</div>
<div class="section level2">
<h2 id="generate-synthetic-routes">Generate synthetic routes<a class="anchor" aria-label="anchor" href="#generate-synthetic-routes"></a>
</h2>
<p>In this section we sample locations from the American Woodcock winter
distribution and then generate routes to their summer grounds.</p>
<p>Set route parameters.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_positions</span> <span class="op">&lt;-</span>  <span class="fl">15</span> <span class="co"># number of starting positions</span></span>
<span><span class="va">n_each</span> <span class="op">&lt;-</span> <span class="fl">1</span>        <span class="co"># how many birds to start at each</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">1</span>         <span class="co"># starting timestep (winter)</span></span>
<span><span class="va">end</span> <span class="op">&lt;-</span> <span class="fl">26</span>          <span class="co"># ending timestep (summer)</span></span></code></pre></div>
<div class="section level3">
<h3 id="generate-starting-locations">Generate starting locations<a class="anchor" aria-label="anchor" href="#generate-starting-locations"></a>
</h3>
<p>First extract the winter distribution, then use
<code>sample_locations()</code> with <code>n = n_positions</code> to
sample the input distribution repeatedly resulting in a matrix in which
each column has a single 1 representing the sampled location.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_distr.html">get_distr</a></span><span class="op">(</span><span class="va">bf</span>, <span class="va">start</span><span class="op">)</span></span>
<span><span class="va">locations</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_distr.html">sample_distr</a></span><span class="op">(</span><span class="va">d</span>, n <span class="op">=</span> <span class="va">n_positions</span><span class="op">)</span>  </span></code></pre></div>
<p>Collapse the locations down to a vector of the index of each non-zero
value and then convert to x and y coordinates.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">locations</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/index_conversions.html">i_to_x</a></span><span class="op">(</span><span class="va">ind</span>, <span class="va">bf</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/index_conversions.html">i_to_y</a></span><span class="op">(</span><span class="va">ind</span>, <span class="va">bf</span><span class="op">)</span></span></code></pre></div>
<p>Plot the starting (winter) distribution and sampled locations</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">winter</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rasterize.html">rasterize_distr</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">bf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">winter</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p><img src="BirdFlowR_files/figure-html/plot%20starting%20distribution-1.png" width="65%"></p>
</div>
<div class="section level3">
<h3 id="generate-routes">Generate routes<a class="anchor" aria-label="anchor" href="#generate-routes"></a>
</h3>
<p><code><a href="../reference/route.html">route()</a></code> will generate synthetic routes for each starting
position. Currently <code><a href="../reference/route.html">route()</a></code> returns a list with two items
(this may change):</p>
<ul>
<li>
<code>points</code> a data.frame with a row for each timestep of
each route</li>
<li>
<code>lines</code> sf object containing a line for each route</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/route.html">route</a></span><span class="op">(</span><span class="va">bf</span>, x_coord <span class="op">=</span> <span class="va">x</span>, y_coord <span class="op">=</span> <span class="va">y</span>, start <span class="op">=</span> <span class="va">start</span>,</span>
<span>             end <span class="op">=</span> <span class="va">end</span>, n <span class="op">=</span> <span class="va">n_each</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rts</span><span class="op">$</span><span class="va">points</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;          x       y route timestep       date</span></span>
<span><span class="co">#&gt; 1 714921.5 4222081     1        1 2019-01-04</span></span>
<span><span class="co">#&gt; 2 714921.5 4222081     1        2 2019-01-11</span></span>
<span><span class="co">#&gt; 3 714921.5 4222081     1        3 2019-01-18</span></span>
<span><span class="co">#&gt; 4 714921.5 4222081     1        4 2019-01-25</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-routes">Plot routes<a class="anchor" aria-label="anchor" href="#plot-routes"></a>
</h3>
<p>Plot the route lines over the summer distribution along with points
at the starting and ending positions.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_distr.html">get_distr</a></span><span class="op">(</span><span class="va">bf</span>, <span class="va">end</span><span class="op">)</span></span>
<span><span class="va">summer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rasterize.html">rasterize_distr</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">bf</span><span class="op">)</span></span>
<span></span>
<span><span class="va">line_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">.2</span><span class="op">)</span></span>
<span><span class="va">pt_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">.5</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">summer</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">x</span>, <span class="va">y</span>, cex <span class="op">=</span> <span class="fl">.4</span>, col <span class="op">=</span> <span class="va">pt_col</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="co"># starting points</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rts</span><span class="op">$</span><span class="va">lines</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="va">line_col</span><span class="op">)</span>  <span class="co"># routes</span></span>
<span><span class="va">end_pts</span> <span class="op">&lt;-</span> <span class="va">rts</span><span class="op">$</span><span class="va">points</span><span class="op">[</span><span class="va">rts</span><span class="op">$</span><span class="va">points</span><span class="op">$</span><span class="va">timestep</span> <span class="op">==</span> <span class="va">end</span>, <span class="op">]</span>  <span class="co"># end points</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">end_pts</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">end_pts</span><span class="op">$</span><span class="va">y</span>,</span>
<span>       cex <span class="op">=</span> <span class="fl">0.4</span>, pch <span class="op">=</span> <span class="fl">12</span>, col <span class="op">=</span> <span class="va">pt_col</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main <span class="op">=</span> <span class="fu"><a href="../reference/species_info.html">species</a></span><span class="op">(</span><span class="va">bf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="BirdFlowR_files/figure-html/plot%20routes-1.png" width="65%"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ethan Plunkett, Daniel Sheldon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
